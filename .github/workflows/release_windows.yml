name: Build and Release Windows App

on:
  push:
    tags:
      - 'v*' # Trigger on tags like v1.0.0

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        
    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v3
      
    - name: Build Windows Installer (Exe & Msi)
      # 두 포맷 모두 생성 (build.gradle.kts에 설정된 대로)
      # --info: 상세 로그 출력, --stacktrace: 스택 트레이스 출력
      run: ./gradlew packageDistributionForCurrentOS --info --stacktrace
      
    - name: Upload Release Assets
      uses: softprops/action-gh-release@v1
      with:
        # 생성된 exe와 msi 파일을 릴리즈에 업로드
        files: |
          sample/composeApp/build/compose/binaries/main/exe/*.exe
          sample/composeApp/build/compose/binaries/main/msi/*.msi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
